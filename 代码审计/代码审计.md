[toc]

# 代码审计

## 流程

```
查看访问控制部分
查看三方组件是否有已知风险
查看一些组件配置，如JWT、Shiro密钥等
查看数据库查询是否存在注入
查看文件IO操作
一些其他敏感操作，如命令执行、反射等
查看重要逻辑，如密码重置
```

反序列化命令执行漏洞挖掘方法：

1、针对一个Java应用，需要找到一个接受外部输入的序列化对象的接收点，即反序列化漏洞的触发点，可以通过审计源码中对反序列化函数的调用（例如readObject()）来寻找，也可以直接通过对应用交互流量进行抓包，查看流量中是否包含Java序列化数据来判断，java序列化数据的特征为以标记ac ed 00 05开头。
2、确定了反序列化输入点后，再考察应用的Class Path中是否包含Apache Commons Collections库（ysoserial所支持的其他库亦可），如果是，就可以使用ysoserial来生成反序列化的payload，指定库名和想要执行的命令。
3、通过先前找到的传入对象方式进行对象注入，数据中载入payload，触发受影响应用中ObjectInputStream的反序列化操作，随后通过反射调用Runtime.getRunTime.exec即可完成利用。

